{"remainingRequest":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liulei/Desktop/Vue/vue-frontend/src/views/students/Student.vue?vue&type=style&index=0&id=22b2a284&scoped=true&lang=css&","dependencies":[{"path":"/Users/liulei/Desktop/Vue/vue-frontend/src/views/students/Student.vue","mtime":1658825160940},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/css-loader/dist/cjs.js","mtime":1657875968436},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1657875963442},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/postcss-loader/src/index.js","mtime":1657875967447},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1657875963855},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/vue-loader/lib/index.js","mtime":1657875961434}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5kZW1vLXRhYmxlLWV4cGFuZCB7CiAgZm9udC1zaXplOiAwOwp9Ci5kZW1vLXRhYmxlLWV4cGFuZCBsYWJlbCB7CiAgd2lkdGg6IDkwcHg7CiAgY29sb3I6ICM5OWE5YmY7Cn0KLmRlbW8tdGFibGUtZXhwYW5kIC5lbC1mb3JtLWl0ZW0gewogIG1hcmdpbi1yaWdodDogMDsKICBtYXJnaW4tYm90dG9tOiAwOwogIHdpZHRoOiA1MCU7Cn0K"},{"version":3,"sources":["Student.vue"],"names":[],"mappings":";AA2VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Student.vue","sourceRoot":"src/views/students","sourcesContent":["<template>\n  <div>\n    <!-- 条件查询 -->\n    <el-form :inline=\"true\" :model=\"search\" ref=\"searchForm\" style=\"margin:20px\">\n      <el-form-item prop=\"name\">\n        <el-input v-model=\"search.name\" placeholder=\"根据姓名查询\" style=\"width:150px\"></el-input>\n      </el-form-item>\n\n      <el-form-item prop=\"directiom\">\n        <el-select v-model=\"search.direction\" placeholder=\"根据学习方向查询\" class=\"filter-item\" style=\"width:150px\">\n          <el-option v-for=\"option in directionOptions\" :key=\"option.type\" :label=\"option.name\" :value=\"option.type\">\n          </el-option>\n        </el-select>\n      </el-form-item>\n\n      <el-form-item prop=\"class\">\n        <el-select v-model=\"search.class\" placeholder=\"根据班级查询\" class=\"filter-item\" style=\"width:150px\">\n          <el-option v-for=\"option in classOptions\" :key=\"option._id\" :label=\"option.name\" :value=\"option.name\">\n          </el-option>\n        </el-select>\n      </el-form-item>\n\n       <el-form-item prop=\"teacher\">\n        <el-input v-model=\"search.teacher\" placeholder=\"根据教师查询\" style=\"width:150px\"></el-input>\n      </el-form-item>\n       <el-form-item prop=\"manager\">\n        <el-input v-model=\"search.manager\" placeholder=\"根据学管查询\" style=\"width:150px\"></el-input>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"searchData\">查询</el-button>\n         <el-button type=\"primary\" icon=\"el-icon-edit\" @click=\"handleAdd\">新增</el-button>\n          <el-button   @click=\"resetForm('searchForm')\">重置</el-button>\n      </el-form-item>\n    </el-form>\n    <!-- 列表 -->\n    <el-table :data=\"students\" style=\"width: 100%\" border>\n      <el-table-column type=\"expand\">\n        <template slot-scope=\"props\">\n          <el-form label-position=\"left\" inline class=\"demo-table-expand\">\n            <el-form-item label=\"学员名字\">\n              <span>{{ props.row.name }}</span>\n            </el-form-item>\n            <el-form-item label=\"性别\">\n              <span>{{ props.row.gender | dataFilter(genderOptions) }}</span>\n            </el-form-item>\n            <el-form-item label=\"所在学校\">\n              <span>{{ props.row.school }}</span>\n            </el-form-item>\n            <el-form-item label=\"专业\">\n              <span>{{ props.row.major }}</span>\n            </el-form-item>\n            <el-form-item label=\"年纪\">\n              <span>{{ props.row.grade }}</span>\n            </el-form-item>\n            <el-form-item label=\"学历\">\n              <span>{{\n                props.row.education | dataFilter(educationOptions)\n              }}</span>\n            </el-form-item>\n            <el-form-item label=\"学习方向\">\n              <span>{{\n                props.row.direction | dataFilter(directionOptions)\n              }}</span>\n            </el-form-item>\n            <el-form-item label=\"身份证号\">\n              <span>{{ props.row.id_number }}</span>\n            </el-form-item>\n            <el-form-item label=\"联系电话\">\n              <span>{{ props.row.phone }}</span>\n            </el-form-item>\n            <el-form-item label=\"家长姓名\">\n              <span>{{ props.row.parent }}</span>\n            </el-form-item>\n            <el-form-item label=\"家庭住址\">\n              <span>{{ props.row.address }}</span>\n            </el-form-item>\n            <el-form-item label=\"QQ号码\">\n              <span>{{ props.row.qq }}</span>\n            </el-form-item>\n            <el-form-item label=\"所在班级\">\n              <span>{{ props.row.class }}</span>\n            </el-form-item>\n            <el-form-item label=\"入学时间\">\n              <span>{{ props.row.admisson_date }}</span>\n            </el-form-item>\n            <el-form-item label=\"授课教师\">\n              <span>{{\n                props.row.teacher_id | teacherOrManagerFilter(teacherOptions)\n              }}</span>\n            </el-form-item>\n            <el-form-item label=\"学管\">\n              <span>{{\n                props.row.manager_id | teacherOrManagerFilter(managerOptions)\n              }}</span>\n            </el-form-item>\n            <el-form-item label=\"照片\">\n              <!-- <span>{{ props.row.pictures }}</span> -->\n              <el-image\n                :key=\"index\"\n                v-for=\"(item, index) in props.row.pictures\"\n                style=\"width: 200px\"\n                :src=\"baseUrl + '/upload/' + item\"\n                :preview-src-list=\"setSrcList(prop.row.pictures)\"\n              >\n              </el-image>\n            </el-form-item>\n            <el-form-item label=\"备注\">\n              <span>{{ props.row.note }}</span>\n            </el-form-item>\n          </el-form>\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"序号\" type=\"index\" width=\"100px\">\n      </el-table-column>\n      <el-table-column label=\"学员姓名\" prop=\"name\" width=\"150px\">\n      </el-table-column>\n      <el-table-column label=\"性别\" prop=\"gender\" width=\"80px\">\n        <template slot-scope=\"scope\">\n          <span>{{ scope.row.gender | dataFilter(genderOptions) }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"学习方向\" prop=\"direction\" width=\"100px\">\n        <template slot-scope=\"scope\">\n          <span>{{ scope.row.direction | dataFilter(directionOptions) }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"联系电话\" prop=\"phone\"> </el-table-column>\n      <el-table-column label=\"所在班级\" prop=\"class\"> </el-table-column>\n      <el-table-column label=\"授课教师\" prop=\"teacher_id\">\n        <template slot-scope=\"scope\">\n          <span>{{\n            scope.row.teacher_id | teacherOrManagerFilter(teacherOptions)\n          }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"学管\" prop=\"manager_id\">\n        <template slot-scope=\"scope\">\n          <span>{{\n            scope.row.manager_id | teacherOrManagerFilter(managerOptions)\n          }}</span>\n        </template>\n      </el-table-column>\n    </el-table>\n    <div>\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"currentPage\"\n        :page-sizes=\"[10, 20, 30, 40]\"\n        :page-size=\"pageSize\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\"\n      >\n      </el-pagination>\n    </div>\n  </div>\n</template>\n\n<script>\nimport studentApi from \"@/api/student.js\";\nimport userApi from \"@/api/user.js\";\nimport classApi from \"@/api/classs.js\";\nimport schoolApi from \"@/api/school.js\";\nimport majorApi from \"@/api/major.js\";\nexport default {\n  data() {\n    return {\n      baseApi: process.env.VUE_APP_BASE_API,\n      baseUrl: process.env.VUE_APP_SERVICE_URL,\n      students: [],\n      totalPage: 1,\n      pageSize: 5, //每页显示条数\n      currentPage: 1, //当前页\n      total: 0, //总计\n      searchMap:{\n        name:'',\n        direction:\"\",\n        class:\"\",\n        teacher_id:\"\",\n        manager_id:\"\"\n      },\n      search:{\n        name:'',\n        direction:\"\",\n        class:\"\",\n        teacher:\"\",\n        manager:\"\"\n      },\n      genderOptions: [\n        //性别\n        { type: \"0\", name: \"男\" },\n        { type: \"1\", name: \"女\" },\n      ],\n      gradeOptions: [\n        //年纪列表\n        { type: \"1\", name: \"大一\" },\n        { type: \"2\", name: \"大二\" },\n        { type: \"3\", name: \"大三\" },\n        { type: \"4\", name: \"大四\" },\n        { type: \"5\", name: \"研究生\" },\n      ],\n      educationOptions: [\n        //学历列表\n        { type: \"1\", name: \"专科\" },\n        { type: \"2\", name: \"本科\" },\n        { type: \"3\", name: \"硕士\" },\n        { type: \"4\", name: \"社会人士\" },\n      ],\n      directionOptions: [\n        { type: \"1\", name: \"Web前端\" },\n        { type: \"2\", name: \"Java\" },\n        { type: \"3\", name: \"UI/UE\" },\n        { type: \"4\", name: \"C/C++\" },\n      ],\n      schoolOptions: [], //学校列表\n      majorOptions: [], //专业列表\n      classOptions: [], //班级列表\n      teacherOptions: [], //教师列表\n      managerOptions: [], //学管列表\n    };\n  },\n  filters: {\n    dataFilter(type, dataOptions) {\n      const obj = dataOptions.find((obj) => obj.type == type);\n      return obj ? obj.name : null;\n    },\n    teacherOrManagerFilter(_id, options) {\n      const obj = options.find((obj) => obj._id == _id);\n      return obj ? obj.name : null;\n    },\n  },\n  components: {},\n  mounted() {\n    this.fetchStudents();\n    this.getUserList();\n    this.getClassList();\n    this.getSchoolList();\n    this.getMajorList();\n  },\n  methods: {\n    fetchStudents() {\n      studentApi\n        .getStudentList(this.currentPage, this.pageSize, this.searchMap)\n        .then((response) => {\n          const resp = response.data;\n          if (resp.status == 0) {\n            this.students = resp.data.data;\n            this.total = resp.data.total;\n          }\n        });\n    },\n    getUserList() {\n      userApi.getUserAll().then((response) => {\n        const res = response.data;\n        if (res.status == 0) {\n          this.userAll = res.data;\n          this.userAll.forEach((item) => {\n            if (item.role_id === \"62da0ff43d303b501d4044ca\") {\n              this.teacherOptions.push(item);\n            } else if (\n              item.role_id === \"62d67e23ac27b13a0e8bd2e7\" ||\n              \"62da19693d303b501d40458a\"\n            ) {\n              this.managerOptions.push(item);\n            }\n          });\n        }\n      });\n    },\n    //获取所有班级\n    getClassList() {\n      classApi.getClassAll().then((response) => {\n        const resp = response.data;\n        if (resp.status == 0) {\n          this.classOptions = resp.data;\n        }\n      });\n    },\n    //获取所有学校\n    getSchoolList() {\n      schoolApi.getSchoolAll().then((response) => {\n        const resp = response.data;\n        if (resp.status == 0) {\n          this.schoolOptions = resp.data;\n        }\n      });\n    },\n    //获取所有专业\n    getMajorList() {\n      majorApi.getMajorAll().then((response) => {\n        const resp = response.data;\n        if (resp.status == 0) {\n          this.majorOptions = resp.data;\n        }\n      });\n    },\n    setSrcList(imgList) {\n      return imgList.map((item) => this.baseUrl + \"/upload/\" + item);\n    },\n    handleSizeChange(val) {\n      this.pageSize = val;\n      this.fetchStudents();\n    },\n    handleCurrentChange(val) {\n      this.currentPage = val;\n      this.fetchStudents();\n    },\n    searchData(){\n        //获取查询表单中输入的教师或学管  在用户列表中根据名称查询对应id 赋值到查询条件对象中\n        this.currentPage=1\n        const resTeacher=this.userAll.find(item=>item.name===this.search.teacher) || {}\n        const resManager=this.userAll.find(item=>item.name===this.search.manager) || {}\n        //  this.searchMap.teacher_id=resTeacher._id || \"\"  不存在教师返回所有数据\n\n        //如果查询到对应的教师就为查询条件对象的教师id赋值\n        if(resTeacher._id){\n            this.searchMap.teacher_id=resTeacher._id\n            //如果输入了教师名称（不存在的）就赋值为-1 防止后端查询时返回所有数据\n        }else if(this.search.teacher){\n            this.searchMap.teacher_id='-1'\n        }else{\n            this.searchMap.teacher_id=\"\"\n        };\n         if(resManager._id){\n            this.searchMap.manager_id=resManager._id\n        }else if(this.search.manager){\n            this.searchMap.manager_id=-'-1'\n        }else{\n            this.searchMap.manager_id=\"\"\n        }\n        this.searchMap.direction=this.search.direction ||\"\";\n        this.searchMap.name=this.search.name ||\"\";\n        this.searchMap.class=this.search.class ||\"\";\n        this.fetchStudents()\n    },\n    handleAdd(){\n      this.$router.push(`/student/update/-1`)\n    },\n    resetForm(formName) {\n        this.$refs[formName].resetFields();\n      }\n  },\n};\n</script>\n\n<style scoped>\n.demo-table-expand {\n  font-size: 0;\n}\n.demo-table-expand label {\n  width: 90px;\n  color: #99a9bf;\n}\n.demo-table-expand .el-form-item {\n  margin-right: 0;\n  margin-bottom: 0;\n  width: 50%;\n}\n</style>"]}]}