{"remainingRequest":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liulei/Desktop/Vue/vue-frontend/src/views/students/School.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liulei/Desktop/Vue/vue-frontend/src/views/students/School.vue","mtime":1658734294145},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1657875963855},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/babel-loader/lib/index.js","mtime":1657875486856},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1657875963855},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/vue-loader/lib/index.js","mtime":1657875961434}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBzY2hvb2xBcGkgZnJvbSAiQC9hcGkvc2Nob29sLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzY2hvb2xGb3JtVmlzaWJsZTogZmFsc2UsIC8v57yW6L6R56qX5Y+j5piv5ZCm5pi+56S6CiAgICAgIHNjaG9vbDogewogICAgICAgIF9pZDogbnVsbCwKICAgICAgICBzY2hvb2xuYW1lOiAiIiwKICAgICAgfSwKICAgICAgc2Nob29sczpbXSwKICAgICAgdG90YWxQYWdlOjEsCiAgICAgIHBhZ2VTaXplOiA1LCAvL+avj+mhteaYvuekuuadoeaVsAogICAgICBjdXJyZW50UGFnZTogMSwgLy/lvZPliY3pobUKICAgICAgdG90YWw6IDAsIC8v5oC76K6hCiAgICAgIHJ1bGVzOiB7CiAgICAgICAgc2Nob29sTmFtZTogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogIuWtpuagoeWQjeensOW/hemhu+i+k+WFpSIsCiAgICAgICAgICAgIHRyaWdnZXI6IFsiYmx1ciIsICJjaGFuZ2UiXSwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgfSwKICAgIH07CiAgfSwKCiAgY29tcG9uZW50czoge30sCiAgbW91bnRlZCgpewogICAgdGhpcy5mZXRjaFNjaG9vbCgpCiAgfSwKCiAgbWV0aG9kczogewogICAgYWRkRGF0YShmb3JtTmFtZSkgewogICAgICB0aGlzLiRyZWZzW2Zvcm1OYW1lXS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHNjaG9vbEFwaS5hZGRTY2hvb2wodGhpcy5zY2hvb2wpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlc3AgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwLCdyZXMnKTsKICAgICAgICAgICAgaWYgKHJlc3Auc3RhdHVzID09IDApIHsKICAgICAgICAgICAgICB0aGlzLnNjaG9vbEZvcm1WaXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5mZXRjaFNjaG9vbCgpOwogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgbWVzc2FnZTogIua3u+WKoOWtpuagoeaIkOWKnyIsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiZXJyb3Igc3VibWl0IiwgZXJyb3IpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlRGF0YShmb3JtTmFtZSkgewogICAgICB0aGlzLiRyZWZzW2Zvcm1OYW1lXS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHNjaG9vbEFwaS51cGRhdGVTY2hvb2wodGhpcy5zY2hvb2wpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlc3AgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICBpZiAocmVzcC5zdGF0dXMgPT0gMCkgewogICAgICAgICAgICAgIHRoaXMuc2Nob29sRm9ybVZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICB0aGlzLmZldGNoU2Nob29sKCk7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAi5pu05paw5a2m5qCh5oiQ5YqfIiwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciBzdWJtaXQiLCBlcnJvcik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVBZGQoKSB7CiAgICAgIHRoaXMuc2Nob29sPXsKICAgICAgICBfaWQ6bnVsbCwKICAgICAgICBzY2hvb2xuYW1lOiIiCiAgICAgIH0KICAgICAgdGhpcy5zY2hvb2xGb3JtVmlzaWJsZSA9IHRydWU7CiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICB0aGlzLiRyZWZzWyJzY2hvb2xGb3JtIl0ucmVzZXRGaWVsZHMoKTsKICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlRWRpdChfaWQpIHsKICAgICAgdGhpcy5oYW5kbGVBZGQoKTsKICAgICAgc2Nob29sQXBpLmdldFNjaG9vbEJ5SWQoX2lkKS50aGVuKChyZXNwb25zZSk9PnsKICAgICAgICBjb25zdCByZXNwID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICBpZihyZXNwLnN0YXR1cz09MCl7CiAgICAgICAgICB0aGlzLnNjaG9vbCA9IHJlc3AuZGF0YQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICAgaGFuZGxlRGVsZXRlKF9pZCkgewogICAgICB0aGlzLiRjb25maXJtKCLnoa7orqTliKDpmaTor6XnlKjmiLflkJfvvJ8iLCAi5o+Q56S6IiwgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi56Gu5a6aIiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAi5Y+W5raIIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgIH0pCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgc2Nob29sQXBpLmRlbGV0ZVNjaG9vbEJ5SWQoX2lkKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICBjb25zdCByZXNwID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgaWYgKHJlc3Auc3RhdHVzID09IDApIHsKICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICLliKDpmaTlrabmoKHmiJDlip8hIiwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLnRvdGFsUGFnZSA9ICh0aGlzLnRvdGFsIC0gMSkvdGhpcy5wYWdlU2l6ZQogICAgICAgICAgICAgIHRoaXMuZmV0Y2hTY2hvb2woKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goKCkgPT4ge30pOwogICAgfSwKICAgIGhhbmRsZVNpemVDaGFuZ2UodmFsKSB7CiAgICAgdGhpcy5wYWdlU2l6ZT12YWwKICAgICAgdGhpcy5mZXRjaFNjaG9vbCgpOwogICAgfSwKICAgIGhhbmRsZUN1cnJlbnRDaGFuZ2UodmFsKSB7CiAgICAgdGhpcy5jdXJyZW50UGFnZT12YWwKICAgICAgdGhpcy5mZXRjaFNjaG9vbCgpOwogICAgfSwKICAgIGZldGNoU2Nob29sKCkgewogICAgICBpZih0aGlzLmN1cnJlbnRQYWdlID4gTWF0aC5jZWlsKHRoaXMudG90YWxQYWdlKSl7CiAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IE1hdGguY2VpbCh0aGlzLnRvdGFsUGFnZSkKICAgICAgfQogICAgICBzY2hvb2xBcGkKICAgICAgICAuZ2V0U2Nob29sTGlzdCh0aGlzLmN1cnJlbnRQYWdlLCB0aGlzLnBhZ2VTaXplKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKCctLS0tLS0nLHJlcyk7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMuc2Nob29scyA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgIHRoaXMudG90YWwgPSByZXMuZGF0YS50b3RhbDsKICAgICAgICAgICAgIHRoaXMudG90YWxQYWdlID0gdGhpcy50b3RhbC90aGlzLnBhZ2VTaXplCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["School.vue"],"names":[],"mappings":";AAwEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"School.vue","sourceRoot":"src/views/students","sourcesContent":["<template>\n  <div>\n    <div style=\"margin: 20px\" class=\"btn_bos\">\n      <el-button type=\"primary\" @click=\"handleAdd\">添加学校</el-button>\n    </div>\n    <el-table :data=\"schools\" height=\"380\" border style=\"width: 100%\">\n      <el-table-column label=\"序号\" type=\"index\" width=\"60\"></el-table-column>\n      <el-table-column label=\"学校名称\" prop=\"schoolname\"></el-table-column>\n      <el-table-column label=\"操作\" width=\"250\">\n        <template slot-scope=\"scope\">\n          <el-button size=\"mini\" @click=\"handleEdit(scope.row._id)\"\n            >编辑</el-button\n          >\n          <el-button\n            size=\"mini\"\n            type=\"danger\"\n            @click=\"handleDelete(scope.row._id)\"\n            >删除</el-button\n          >\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-dialog\n      title=\"添加/编辑\"\n      :visible.sync=\"schoolFormVisible\"\n      width=\"500px\"\n    >\n      <el-form\n        status-icon\n        :model=\"school\"\n        ref=\"schoolForm\"\n        label-width=\"100px\"\n        label-position=\"right\"\n        style=\"width: 400px\"\n        :rules=\"rules\"\n      >\n        <el-form-item label=\"学校名称\" prop=\"schoolname\">\n          <el-input\n            v-model=\"school.schoolname\"\n            placeholder=\"请输入学校名称\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"schoolFormVisible = false\">取 消</el-button>\n        <el-button\n          type=\"primary\"\n          @click=\"\n            school._id == null\n              ? addData('schoolForm')\n              : updateData('schoolForm')\n          \"\n          >确 定</el-button\n        >\n      </div>\n    </el-dialog>\n    <div>\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"currentPage\"\n        :page-sizes=\"[5, 10, 15, 20]\"\n        :page-size=\"pageSize\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\"\n      >\n      </el-pagination>\n    </div>\n  </div>\n</template>\n\n<script>\nimport schoolApi from \"@/api/school.js\";\nexport default {\n  data() {\n    return {\n      schoolFormVisible: false, //编辑窗口是否显示\n      school: {\n        _id: null,\n        schoolname: \"\",\n      },\n      schools:[],\n      totalPage:1,\n      pageSize: 5, //每页显示条数\n      currentPage: 1, //当前页\n      total: 0, //总计\n      rules: {\n        schoolName: [\n          {\n            required: true,\n            message: \"学校名称必须输入\",\n            trigger: [\"blur\", \"change\"],\n          },\n        ],\n      },\n    };\n  },\n\n  components: {},\n  mounted(){\n    this.fetchSchool()\n  },\n\n  methods: {\n    addData(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          schoolApi.addSchool(this.school).then((response) => {\n            const resp = response.data;\n            console.log(resp,'res');\n            if (resp.status == 0) {\n              this.schoolFormVisible = false;\n              this.fetchSchool();\n              this.$message({\n                type: \"success\",\n                message: \"添加学校成功\",\n              });\n            }\n          });\n        } else {\n          console.log(\"error submit\", error);\n          return false;\n        }\n      });\n    },\n    updateData(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          schoolApi.updateSchool(this.school).then((response) => {\n            const resp = response.data;\n            if (resp.status == 0) {\n              this.schoolFormVisible = false;\n              this.fetchSchool();\n              this.$message({\n                type: \"success\",\n                message: \"更新学校成功\",\n              });\n            }\n          });\n        } else {\n          console.log(\"error submit\", error);\n          return false;\n        }\n      });\n    },\n    handleAdd() {\n      this.school={\n        _id:null,\n        schoolname:\"\"\n      }\n      this.schoolFormVisible = true;\n      this.$nextTick(() => {\n        this.$refs[\"schoolForm\"].resetFields();\n      });\n    },\n    handleEdit(_id) {\n      this.handleAdd();\n      schoolApi.getSchoolById(_id).then((response)=>{\n        const resp = response.data;\n        if(resp.status==0){\n          this.school = resp.data\n        }\n      })\n    },\n     handleDelete(_id) {\n      this.$confirm(\"确认删除该用户吗？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          schoolApi.deleteSchoolById(_id).then((response) => {\n            const resp = response.data;\n            if (resp.status == 0) {\n              this.$message({\n                type: \"success\",\n                message: \"删除学校成功!\",\n              });\n              this.totalPage = (this.total - 1)/this.pageSize\n              this.fetchSchool();\n            }\n          });\n        }).catch(() => {});\n    },\n    handleSizeChange(val) {\n     this.pageSize=val\n      this.fetchSchool();\n    },\n    handleCurrentChange(val) {\n     this.currentPage=val\n      this.fetchSchool();\n    },\n    fetchSchool() {\n      if(this.currentPage > Math.ceil(this.totalPage)){\n        this.currentPage = Math.ceil(this.totalPage)\n      }\n      schoolApi\n        .getSchoolList(this.currentPage, this.pageSize)\n        .then((response) => {\n          const res = response.data;\n          console.log('------',res);\n          if (res.status == 0) {\n            this.schools = res.data.data;\n            this.total = res.data.total;\n             this.totalPage = this.total/this.pageSize\n          }\n        });\n    },\n  },\n};\n</script>\n\n<style scoped>\n</style>"]}]}