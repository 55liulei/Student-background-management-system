{"remainingRequest":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liulei/Desktop/Vue/vue-frontend/src/views/user/User.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liulei/Desktop/Vue/vue-frontend/src/views/user/User.vue","mtime":1658549813539},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1657875963855},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/babel-loader/lib/index.js","mtime":1657875486856},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1657875963855},{"path":"/Users/liulei/Desktop/Vue/vue-frontend/node_modules/vue-loader/lib/index.js","mtime":1657875961434}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB1c2VyQXBpIGZyb20gIkAvYXBpL3VzZXIuanMiOwppbXBvcnQgeyBmb3JtYXRlRGF0ZUxlc3MgfSBmcm9tICJAL3V0aWxzL2RhdGVVdGlscyI7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgdmFyIHZhbGlkYXRhVXNlck5hbWUgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIHZhbHVlID0gdmFsdWUudHJpbSgpOwogICAgICBjb25zdCBsZW5ndGggPSB2YWx1ZSAmJiB2YWx1ZS5sZW5ndGg7CiAgICAgIGNvbnN0IHB3ZFJlZyA9IC9eW2EtekEtejAtOV9dKyQvOwogICAgICBpZiAodmFsdWUgPT09ICIiKSB7CiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCLor7fovpPlhaXotKblj7ciKSk7CiAgICAgIH0gZWxzZSBpZiAobGVuZ3RoIDwgNCB8fCBsZW5ndGggPiAxMikgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigi6ZW/5bqm5ZyoNC0xMuS4quWtl+espuS5i+mXtCIpKTsKICAgICAgfSBlbHNlIGlmICghcHdkUmVnLnRlc3QodmFsdWUpKSB7CiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCLotKblj7flv4XpobvnlLHoi7HmlofjgIHlrZfmr43miJbkuIvliJLnur/nu4TmiJAiKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfTsKICAgIHZhciB2YWxpZGF0YVBob25lID0gKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgPT4gewogICAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTsKICAgICAgY29uc3QgcHdkUmVnID0KICAgICAgICAvXigxM1swLTldfDE0WzAxNDU2ODc5XXwxNVswLTM1LTldfDE2WzI1NjddfDE3WzAtOF18MThbMC05XXwxOVswLTM1LTldKVxkezh9JC87CiAgICAgIGlmICh2YWx1ZSA9PT0gIiIpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoIuivt+i+k+WFpeaJi+acuuWPt+eggSIpKTsKICAgICAgfSBlbHNlIGlmICghcHdkUmVnLnRlc3QodmFsdWUpKSB7CiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCLor7fovpPlhaXmraPnoa7miYvmnLrlj7fnoIEiKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfTsKICAgIHJldHVybiB7CiAgICAgIHVzZXJGb3JtVmlzaWJsZTogZmFsc2UsIC8v57yW6L6R56qX5Y+j5piv5ZCm5pi+56S6CiAgICAgIHRvdGFsUGFnZToxLAogICAgICB1c2VyOiB7CiAgICAgICAgLy/mlrDlop7miJbnvJbovpHnlKjmiLfmlbDmja4KICAgICAgICBfaWQ6IG51bGwsCiAgICAgICAgdXNlcm5hbWU6ICIiLAogICAgICAgIHBhc3N3b3JkOiAiIiwKICAgICAgICBuYW1lOiAiIiwKICAgICAgICBwaG9uZTogIiIsCiAgICAgICAgcm9sZV9pZDogIiIsCiAgICAgIH0sCiAgICAgIHJ1bGVzOiB7CiAgICAgICAgdXNlcm5hbWU6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIHZhbGlkYXRvcjogdmFsaWRhdGFVc2VyTmFtZSwKICAgICAgICAgICAgdHJpZ2dlcjogWyJibHVyIiwgImNoYW5nZSJdLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgIHBob25lOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICB2YWxpZGF0b3I6IHZhbGlkYXRhUGhvbmUsCiAgICAgICAgICAgIHRyaWdnZXI6IFsiYmx1ciIsICJjaGFuZ2UiXSwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgICBwYXNzd29yZDogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogIuivt+i+k+WFpeWvhueggSIsCiAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG1pbjogNCwKICAgICAgICAgICAgbWVzc2FnZTogIuWvhueggemVv+W6pumcgOWkp+S6juetieS6jjTkvY0iLAogICAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgbmFtZTogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogIuivt+i+k+WFpeWnk+WQjSIsCiAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgICByb2xlX2lkOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiAi6K+36YCJ5oup6KeS6ImyIiwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICB9LAogICAgICByb2xlT3B0aW9uczogW10sCiAgICAgIHVzZXJzOiBbXSwKICAgICAgcGFnZVNpemU6IDUsIC8v5q+P6aG15pi+56S65p2h5pWwCiAgICAgIGN1cnJlbnRQYWdlOiAxLCAvL+W9k+WJjemhtQogICAgICB0b3RhbDogMCwgLy/mgLvorqEKICAgIH07CiAgfSwKCiAgY29tcG9uZW50czoge30sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuZmV0Y2hVc2VycygpOwogIH0sCiAgbWV0aG9kczogewogICAgZmV0Y2hVc2VycygpIHsKICAgICAgaWYodGhpcy5jdXJyZW50UGFnZSA+IE1hdGguY2VpbCh0aGlzLnRvdGFsUGFnZSkpewogICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSBNYXRoLmNlaWwodGhpcy50b3RhbFBhZ2UpCiAgICAgIH0KICAgICAgdXNlckFwaS5nZXRVc2VyTGlzdCh0aGlzLmN1cnJlbnRQYWdlLCB0aGlzLnBhZ2VTaXplKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGNvbnN0IHJlc3AgPSByZXNwb25zZS5kYXRhOwogICAgICAgIGlmIChyZXNwLnN0YXR1cyA9PT0gMCkgewogICAgICAgICAgdGhpcy51c2VycyA9IHJlc3AuZGF0YS5kYXRhOwogICAgICAgICAgdGhpcy5yb2xlT3B0aW9ucyA9IHJlc3AuZGF0YS5yb2xlczsKICAgICAgICAgIHRoaXMudG90YWwgPSByZXNwLmRhdGEudG90YWw7CiAgICAgICAgICB0aGlzLnRvdGFsUGFnZSA9IHRoaXMudG90YWwvdGhpcy5wYWdlU2l6ZQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlU2l6ZUNoYW5nZSh2YWwpIHsKICAgICAgY29uc29sZS5sb2coYOavj+mhtSAke3ZhbH0g5p2hYCk7CiAgICAgIHRoaXMucGFnZVNpemU9dmFsCiAgICAgICB0aGlzLmZldGNoVXNlcnMoKTsKICAgIH0sCiAgICBoYW5kbGVDdXJyZW50Q2hhbmdlKHZhbCkgewogICAgICBjb25zb2xlLmxvZyhg5b2T5YmN6aG1OiAke3ZhbH1gKTsKICAgICAgdGhpcy5jdXJyZW50UGFnZT12YWwKICAgICAgIHRoaXMuZmV0Y2hVc2VycygpOwogICAgfSwKICAgIGhhbmRsZUVkaXQoX2lkKSB7CiAgICAgIHRoaXMuaGFuZGxlQWRkKCk7CiAgICAgIHVzZXJBcGkuZ2V0VXNlckJ5SWQoX2lkKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGNvbnN0IHJlc3AgPSByZXNwb25zZS5kYXRhOwogICAgICAgIGlmIChyZXNwLnN0YXR1cyA9PSAwKSB7CiAgICAgICAgICB0aGlzLnVzZXIgPSByZXNwLmRhdGE7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVEZWxldGUoaWQpIHsKICAgICAgdGhpcy4kY29uZmlybSgi56Gu6K6k5Yig6Zmk5pS555So5oi35ZCX77yfIiwgIuaPkOekuiIsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIuehruWumiIsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIuWPlua2iCIsCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICB9KQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHVzZXJBcGkuZGVsZXRlVXNlckJ5SWQoaWQpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlc3AgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICBpZiAocmVzcC5zdGF0dXMgPT0gMCkgewogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgbWVzc2FnZTogIuWIoOmZpOaIkOWKnyEiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMudG90YWxQYWdlID0gKHRoaXMudG90YWwgLSAxKS90aGlzLnBhZ2VTaXplCiAgICAgICAgICAgICAgdGhpcy5mZXRjaFVzZXJzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goKCkgPT4ge30pOwogICAgfSwKICAgIHJlc2V0RGF0ZShyb3csIGNvbHVtbiwgY2VsbFZhbHVlLCBpbmRleCkgewogICAgICByZXR1cm4gZm9ybWF0ZURhdGVMZXNzKGNlbGxWYWx1ZSk7CiAgICB9LAogICAgZ2VSb2xlKHJvdyxjb2x1bW4sY2VsbFZhbHVlLGluZGV4KXsKICAgICAgcmV0dXJuICB0aGlzLnJvbGVPcHRpb25zLmZpbmQoaXRlbT0+aXRlbS5faWQ9PT1jZWxsVmFsdWUpLm5hbWUKICAgIH0sCiAgICAvL+a3u+WKoOeUqOaItwogICAgYWRkRGF0YShmb3JtTmFtZSkgewogICAgICB0aGlzLiRyZWZzW2Zvcm1OYW1lXS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHVzZXJBcGkuYWRkVXNlcih0aGlzLnVzZXIpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09IDApIHsKICAgICAgICAgICAgICB0aGlzLmZldGNoVXNlcnMoKTsKICAgICAgICAgICAgICB0aGlzLnVzZXJGb3JtVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgbWVzc2FnZTogIua3u+WKoOeUqOaIt+aIkOWKnyIsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v5paw5aKe5oiQ5Yqf77yM5Yi35paw5YiX6KGo5pWw5o2uCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy/miZPlvIDnlKjmiLfnqpflj6MKICAgIGhhbmRsZUFkZCgpIHsKICAgICAgKHRoaXMudXNlciA9IHsKICAgICAgICBfaWQ6IG51bGwsCiAgICAgICAgdXNlcm5hbWU6ICIiLAogICAgICAgIHBhc3N3b3JkOiAiIiwKICAgICAgICBuYW1lOiAiIiwKICAgICAgICBwaG9uZTogIiIsCiAgICAgICAgcm9sZV9pZDogIiIsCiAgICAgIH0pLAogICAgICAgICh0aGlzLnVzZXJGb3JtVmlzaWJsZSA9IHRydWUpOwogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgdGhpcy4kcmVmc1sidXNlckZvcm0iXS5yZXNldEZpZWxkcygpOwogICAgICB9KTsKICAgIH0sCiAgICAvL+abtOaWsOeUqOaIt+aVsOaNrgogICAgdXBkYXRlRGF0YShmb3JtTmFtZSkgewogICAgICB0aGlzLiRyZWZzW2Zvcm1OYW1lXS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHVzZXJBcGkudXBkYXRlVXNlcih0aGlzLnVzZXIpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09IDApIHsKICAgICAgICAgICAgICB0aGlzLmZldGNoVXNlcnMoKTsKICAgICAgICAgICAgICB0aGlzLnVzZXJGb3JtVmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgbWVzc2FnZTogIuabtOaWsOeUqOaIt+aVsOaNruaIkOWKnyIsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy/mlrDlop7miJDlip/vvIzliLfmlrDliJfooajmlbDmja4KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["User.vue"],"names":[],"mappings":";AA8FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"User.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\n  <div>\n    <div style=\"margin: 20px 0\">\n      <el-button type=\"primary\" @click=\"handleAdd\">添加用户</el-button>\n    </div>\n    <el-table :data=\"users\" heigth=\"380\" border style=\"width: 100%\">\n      <el-table-column label=\"序号\" width=\"60\" type=\"index\"></el-table-column>\n      <el-table-column label=\"用户名\" prop=\"username\"></el-table-column>\n      <el-table-column label=\"姓名\" prop=\"name\"></el-table-column>\n      <el-table-column label=\"电话\" prop=\"phone\"></el-table-column>\n      <el-table-column\n        label=\"创建时间\"\n        prop=\"create_time\"\n        :formatter=\"resetDate\"\n      ></el-table-column>\n      <el-table-column label=\"所属角色\" prop=\"role_id\" :formatter=\"geRole\"></el-table-column>\n      <el-table-column label=\"操作\" width=\"250\">\n        <template slot-scope=\"scope\">\n          <el-button size=\"mini\" @click=\"handleEdit(scope.row._id)\"\n            >编辑</el-button\n          >\n          <el-button\n            size=\"mini\"\n            type=\"danger\"\n            @click=\"handleDelete(scope.row._id)\"\n            >删除</el-button\n          >\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-pagination\n      @size-change=\"handleSizeChange\"\n      @current-change=\"handleCurrentChange\"\n      :current-page=\"currentPage\"\n      :page-sizes=\"[5, 10, 15, 20]\"\n      :page-size=\"pageSize\"\n      layout=\"total, sizes, prev, pager, next, jumper\"\n      :total=\"total\"\n    >\n    </el-pagination>\n    <!-- 添加用户表单 -->\n    <el-dialog title=\"添加用户\" :visible.sync=\"userFormVisible\" width=\"500px\">\n      <el-form\n        status-icon\n        :model=\"user\"\n        ref=\"userForm\"\n        label-width=\"100px\"\n        label-position=\"right\"\n        style=\"width: 400px\"\n        :rules=\"rules\"\n      >\n        <el-form-item label=\"用户名\" prop=\"username\">\n          <el-input v-model=\"user.username\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"密码\" prop=\"password\">\n          <el-input v-model=\"user.password\" type=\"password\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"姓名\" prop=\"name\">\n          <el-input v-model=\"user.name\" palceholder=\"请输入姓名\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"角色\" prop=\"role_id\">\n          <el-select\n            v-model=\"user.role_id\"\n            class=\"filter-item\"\n            placeholder=\"请点击选择\"\n          >\n            <el-option\n              v-for=\"option in roleOptions\"\n              :key=\"option._id\"\n              :label=\"option.name\"\n              :value=\"option._id\"\n            >\n            </el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"手机号码\" prop=\"phone\">\n          <el-input v-model=\"user.phone\"></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"userFormVisible = false\">取 消</el-button>\n        <el-button\n          type=\"primary\"\n          @click=\"\n            user._id == null ? addData('userForm') : updateData('userForm')\n          \"\n          >确 定</el-button\n        >\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport userApi from \"@/api/user.js\";\nimport { formateDateLess } from \"@/utils/dateUtils\";\nexport default {\n  data() {\n    var validataUserName = (rule, value, callback) => {\n      value = value.trim();\n      const length = value && value.length;\n      const pwdReg = /^[a-zA-z0-9_]+$/;\n      if (value === \"\") {\n        callback(new Error(\"请输入账号\"));\n      } else if (length < 4 || length > 12) {\n        callback(new Error(\"长度在4-12个字符之间\"));\n      } else if (!pwdReg.test(value)) {\n        callback(new Error(\"账号必须由英文、字母或下划线组成\"));\n      } else {\n        callback();\n      }\n    };\n    var validataPhone = (rule, value, callback) => {\n      value = value.trim();\n      const pwdReg =\n        /^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\\d{8}$/;\n      if (value === \"\") {\n        callback(new Error(\"请输入手机号码\"));\n      } else if (!pwdReg.test(value)) {\n        callback(new Error(\"请输入正确手机号码\"));\n      } else {\n        callback();\n      }\n    };\n    return {\n      userFormVisible: false, //编辑窗口是否显示\n      totalPage:1,\n      user: {\n        //新增或编辑用户数据\n        _id: null,\n        username: \"\",\n        password: \"\",\n        name: \"\",\n        phone: \"\",\n        role_id: \"\",\n      },\n      rules: {\n        username: [\n          {\n            required: true,\n            validator: validataUserName,\n            trigger: [\"blur\", \"change\"],\n          },\n        ],\n        phone: [\n          {\n            required: true,\n            validator: validataPhone,\n            trigger: [\"blur\", \"change\"],\n          },\n        ],\n        password: [\n          {\n            required: true,\n            message: \"请输入密码\",\n            trigger: \"blur\",\n          },\n          {\n            min: 4,\n            message: \"密码长度需大于等于4位\",\n            trigger: \"blur\",\n          },\n        ],\n        name: [\n          {\n            required: true,\n            message: \"请输入姓名\",\n            trigger: \"blur\",\n          },\n        ],\n        role_id: [\n          {\n            required: true,\n            message: \"请选择角色\",\n            trigger: \"blur\",\n          },\n        ],\n      },\n      roleOptions: [],\n      users: [],\n      pageSize: 5, //每页显示条数\n      currentPage: 1, //当前页\n      total: 0, //总计\n    };\n  },\n\n  components: {},\n  mounted() {\n    this.fetchUsers();\n  },\n  methods: {\n    fetchUsers() {\n      if(this.currentPage > Math.ceil(this.totalPage)){\n        this.currentPage = Math.ceil(this.totalPage)\n      }\n      userApi.getUserList(this.currentPage, this.pageSize).then((response) => {\n        const resp = response.data;\n        if (resp.status === 0) {\n          this.users = resp.data.data;\n          this.roleOptions = resp.data.roles;\n          this.total = resp.data.total;\n          this.totalPage = this.total/this.pageSize\n        }\n      });\n    },\n    handleSizeChange(val) {\n      console.log(`每页 ${val} 条`);\n      this.pageSize=val\n       this.fetchUsers();\n    },\n    handleCurrentChange(val) {\n      console.log(`当前页: ${val}`);\n      this.currentPage=val\n       this.fetchUsers();\n    },\n    handleEdit(_id) {\n      this.handleAdd();\n      userApi.getUserById(_id).then((response) => {\n        const resp = response.data;\n        if (resp.status == 0) {\n          this.user = resp.data;\n        }\n      });\n    },\n    handleDelete(id) {\n      this.$confirm(\"确认删除改用户吗？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          userApi.deleteUserById(id).then((response) => {\n            const resp = response.data;\n            if (resp.status == 0) {\n              this.$message({\n                type: \"success\",\n                message: \"删除成功!\",\n              });\n              this.totalPage = (this.total - 1)/this.pageSize\n              this.fetchUsers();\n            }\n          \n          });\n        }).catch(() => {});\n    },\n    resetDate(row, column, cellValue, index) {\n      return formateDateLess(cellValue);\n    },\n    geRole(row,column,cellValue,index){\n      return  this.roleOptions.find(item=>item._id===cellValue).name\n    },\n    //添加用户\n    addData(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          userApi.addUser(this.user).then((response) => {\n            const res = response.data;\n            if (res.status == 0) {\n              this.fetchUsers();\n              this.userFormVisible = false;\n              this.$message({\n                type: \"success\",\n                message: \"添加用户成功\",\n              });\n            }\n\n            //新增成功，刷新列表数据\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    //打开用户窗口\n    handleAdd() {\n      (this.user = {\n        _id: null,\n        username: \"\",\n        password: \"\",\n        name: \"\",\n        phone: \"\",\n        role_id: \"\",\n      }),\n        (this.userFormVisible = true);\n      this.$nextTick(() => {\n        this.$refs[\"userForm\"].resetFields();\n      });\n    },\n    //更新用户数据\n    updateData(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          userApi.updateUser(this.user).then((response) => {\n            const res = response.data;\n            if (res.status == 0) {\n              this.fetchUsers();\n              this.userFormVisible = false;\n              this.$message({\n                type: \"success\",\n                message: \"更新用户数据成功\",\n              });\n            }\n            //新增成功，刷新列表数据\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style scoped>\n</style>"]}]}